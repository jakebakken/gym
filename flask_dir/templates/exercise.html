{% extends 'base.html' %}{% block title %}Exercise{% endblock %}
<body>
    {% block content %}
    <div id="start-workout-div">
        <button
                id="start-workout-button"
                name="start-workout-button"
                value="start-workout-button"
                class="btn btn-success"
                onclick="startWorkout();"
                type="button"
        >Start Workout</button>
    </div>
    <form id="exercise-form" method="POST">

        <h1 id="page-title" align="center">Exercise</h1>

        <table id="exercise-table">
            <thead>
                <tr>
                    <th colspan="2">
                        <input
                                type="text"
                                class="form-exercise-title-input"
                                id="workout-name"
                                name="workout-name"
                                placeholder="Workout Name"
                        >
                        <hr/>
                    </th>
                </tr>
            </thead>
            <tbody id="exercise-table-body">
                <tr><th colspan="2" class="exercise-header">Exercise 1</th></tr>
                <tr>
                    <td colspan="2">
                        <input
                                type="text"
                                class="form-exercise-title-input"
                                id="exercise1-name"
                                name="exercise1-name"
                                placeholder="Exercise Name"
                        >
                    </td>
                </tr>

                <tr><th colspan="2">Set 1</th></tr>
                <tr>
                    <td>
                        <input
                                type="number"
                                class="form-exercise"
                                id="exercise1-set1-reps"
                                name="exercise1-set1-reps"
                                placeholder="Reps"
                        >
                    </td>
                    <td>
                        <input
                                type="number"
                                class="form-exercise"
                                id="exercise1-set1-weight"
                                name="exercise1-set1-weight"
                                placeholder="Weight"
                        >
                    </td>
                </tr>
            </tbody>
        </table>
        <!-- Dropdown for LBS / KG -->
        <div class="add-div">
            <button
                    id="add-exercise-button"
                    name="add-exercise-button"
                    value="add-exercise-button"
                    class="btn btn-primary"
                    type="button"
                    onclick="addExercise();"
            >Add Exercise</button>
            <button
                    id="add-set-button"
                    name="add-set-button"
                    value="add-set-button"
                    class="btn btn-primary"
                    type="button"
                    onclick="addSet();"
            >Add Set</button>
        </div>
        <div class="slider-container">
            <p>Workout Rating: <span id="workout-rating-value"></span></p>
            <input type="range" min="1" max="10" value="5" class="slider" id="workout-rating" name="workout-rating">
        </div>
        <div id="finish-workout-div">
            <button
                    id="finish-workout-button"
                    name="finish-workout-button"
                    value="finish-workout-button"
                    class="btn btn-danger"
                    type="button"
                    onclick="finishWorkout();"
            >Finish Workout</button>
        </div>
    </form>
    <script type="text/javascript">
        window.onload = function () {
            var exerciseNumber = 1;
            var setNumber = 1;

            const addExerciseButton = document.getElementById("add-exercise-button");
            const addSetButton = document.getElementById("add-set-button");
            const exerciseTableBody = document.getElementById("exercise-table-body");

            addSetButton.onclick = function addSet() {
            // add new set every click, max 10 sets
                // increment set count
                setNumber += 1;

                const header_row = document.createElement("tr");
                const header = document.createElement("th");
                const data_row = document.createElement("tr");
                const reps_data = document.createElement("td");
                const weight_data = document.createElement("td");
                const reps_input = document.createElement("input");
                const weight_input = document.createElement("input");

                header.innerText = "Set " + setNumber;
                header.setAttribute("colspan", 2);

                reps_input.type = "number";
                reps_input.id = "exercise" + exerciseNumber + "-set" + setNumber + "-reps";
                reps_input.name = "exercise" + exerciseNumber + "-set" + setNumber + "-reps";
                reps_input.setAttribute("class", "form-exercise");
                reps_input.placeholder = "Reps";

                weight_input.type = "number";
                weight_input.id = "exercise" + exerciseNumber + "-set" + setNumber + "-weight";
                weight_input.name = "exercise" + exerciseNumber + "-set" + setNumber + "-weight";
                weight_input.setAttribute("class", "form-exercise");
                weight_input.placeholder = "Weight";

                if (setNumber <= 10) {
                    // add set header
                    header_row.append(header);

                    // add input areas to respective table data tags
                    reps_data.append(reps_input);
                    weight_data.append(weight_input);

                    // add data tags to single table row
                    data_row.append(reps_data);
                    data_row.append(weight_data);

                    // add header row & data row to exercise table
                    exerciseTableBody.append(header_row);
                    exerciseTableBody.append(data_row);
                };
            };

            // lol all these vars need to be in js syntax not python

            addExerciseButton.onclick = function addExercise() {
            // add new exercise every click, max 15 exercises
                // increment exercise count
                exerciseNumber += 1;

                const header_row = document.createElement("tr");
                const header = document.createElement("th");
                const exercise_input_row = document.createElement("tr");
                const exercise_input_data = document.createElement("td");
                const exercise_input = document.createElement("input");

                const set1_header_row = document.createElement("tr");
                const set1_header = document.createElement("th");

                const set1_data_row = document.createElement("tr");
                const set1_reps_data = document.createElement("td");
                const set1_weight_data = document.createElement("td");
                const set1_reps_input = document.createElement("input");
                const set1_weight_input = document.createElement("input");

                header.innerText = "Exercise " + exerciseNumber;
                header.setAttribute("colspan", 2);

                exercise_input_data.setAttribute("colspan", 2);
                exercise_input.type = "text";
                exercise_input.setAttribute("class", "form-exercise-title-input");
                exercise_input.id = "exercise" + exerciseNumber + "-name";
                exercise_input.name = "exercise" + exerciseNumber + "-name";
                exercise_input.placeholder = "Exercise Name";

                set1_header.innerText = "Set 1";
                set1_header.setAttribute("colspan", 2);

                set1_reps_input.type = "number";
                set1_reps_input.id = "exercise" + exerciseNumber + "-set1-reps";
                set1_reps_input.name = "exercise" + exerciseNumber + "-set1-reps";
                set1_reps_input.setAttribute("class", "form-exercise");
                set1_reps_input.placeholder = "Reps";

                set1_weight_input.type = "number";
                set1_weight_input.id = "exercise" + exerciseNumber + "-set1-weight";
                set1_weight_input.name = "exercise" + exerciseNumber + "-set1-weight";
                set1_weight_input.setAttribute("class", "form-exercise");
                set1_weight_input.placeholder = "Weight";

                if (exerciseNumber <= 15) {
                    // add headers
                    header_row.append(header);
                    set1_header_row.append(set1_header);

                    // add static 3 sets to respective data tags
                    exercise_input_data.append(exercise_input);
                    set1_reps_data.append(set1_reps_input);
                    set1_weight_data.append(set1_weight_input);

                    // add data tags to each row
                    exercise_input_row.append(exercise_input_data);
                    set1_data_row.append(set1_reps_data);
                    set1_data_row.append(set1_weight_data);

                    // add header row & data rows to exercise table
                    exerciseTableBody.append(header_row);
                    exerciseTableBody.append(exercise_input_row);
                    exerciseTableBody.append(set1_header_row);
                    exerciseTableBody.append(set1_data_row);
                };

                // reset set count whenever new exercise added
                setNumber = 1;
            };
        };
        var slider = document.getElementById("workout-rating");
        var output = document.getElementById("workout-rating-value");
        output.innerHTML = slider.value;

        slider.oninput = function () {
            output.innerHTML = this.value;
        };

        function finishWorkout() {
            var workoutName = $("#workout-name").val();
            var rating = $("#workout-rating").val();

            finish = $.ajax({
                type: 'POST',
                url: '/finish-workout',
                data: {
                    workoutName: workoutName,  // info to send to backend
                    rating: rating,
                },
                success: function(workoutName) {
                    console.log(workoutName);
                }
            });

            // json object that gets passed back to frontend after ajax done
            finish.done(function(data) {
                $('#workout-name').text(data.workout_name);
                $('#finish-workout-button').attr('disabled', false);
            });
        };

        function startWorkout() {
            start = $.ajax({
                type: 'POST',
                url: '/start-workout',
                success: function() {
                    console.log("workout started");
                }
            });

            start.done(function() {
                $('#start-workout-button').hide();
                $('#exercise-form').show();
            });
        };
    </script>
    {% endblock %}
</body>